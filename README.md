# KantanPro (KTPWP)

WordPress上で受注・顧客・サービス・仕入先・レポート・スタッフチャットまで一元管理できる総合ビジネス管理プラグイン

---

## 主な機能

- 7つの管理タブ（仕事リスト・伝票処理・得意先・サービス・協力会社・レポート・設定）
- 受注案件の進捗管理（6段階）
- 受注書の作成・編集・印刷・プレビュー
- 顧客・サービス・仕入先のマスター管理
- 協力会社商品管理（商品名・単価・数量・単位の詳細管理）
- スタッフ間チャット（自動スクロール・削除連動）
- 売上・進捗・顧客別レポート
- 印刷・宛名テンプレート
- 未ログインユーザー向け案内機能（登録リンク自動表示）
- 直感的なタブUI・ページネーション・ソート・検索
- 案件名インライン編集（リアルタイム更新）
- レスポンシブデザイン

---

## 直近の実装・改善点

- 職能管理機能を商品管理機能に拡張（商品名・単価・数量・単位の詳細管理）
- サービス選択ポップアップにページネーション機能を実装
- カード型リストビューでの統一されたUI設計
- 案件名インライン編集機能（Ajax対応）
- 未ログインユーザー向け表示の改善（KTPWPからKantanProへの表記統一）
- ユーザー登録リンクの追加とホームページリンクの最適化
- スタッフチャット自動スクロール・キーボードショートカット
- オーダー削除時のチャットデータ自動削除
- オーダー削除後の自動作成防止
- セキュリティ強化（CSRF, SQLi, XSS, 権限制御）

---

## セキュリティ対策

- SQLインジェクション防止
- XSS・CSRF対策
- ファイルアップロード検証
- 権限管理・安全なDBアクセス

---

## インストール

1. プラグインを `/wp-content/plugins/` にアップロード、または管理画面からインストール
2. プラグインを有効化
3. 固定ページに `[ktpwp_all_tab]` を挿入

---

## 基本的な使い方

1. **ショートコードの設置**
   固定ページに `[ktpwp_all_tab]` を挿入すると、7つのタブが表示されます。

2. **顧客情報の登録**
   「得意先」タブから顧客情報を登録してください。

3. **サービスの登録**
   「サービス」タブから提供するサービス・商品を登録してください。

4. **協力会社の商品管理**
   「協力会社」タブから各協力会社の提供商品・サービスを管理してください。

5. **案件名の編集**
   仕事リストで案件名をクリックするとインライン編集できます。

6. **受注書の作成**
   「伝票処理」タブから新規受注書を作成し、顧客とサービスを選択してください。

7. **進捗管理**
   「仕事リスト」タブで案件の進捗を管理してください。

6. **進捗ステータス**

進捗は以下の6段階で管理されます：

1. **受付中** - 新規受注、内容確認中
2. **見積中** - 見積作成・提案中
3. **作成中** - 作業実行中
4. **完成未請求** - 作業完了、請求書未発行
5. **請求済** - 請求書発行済み
6. **入金済** - 支払い完了

---

## 管理画面設定

管理画面の「KantanPro」から基本設定を行ってください。

- **一般設定**: プラグインの基本設定を行います
- **メール・SMTP設定**: メール送信に関する基本設定を行います
- **デザイン**: プラグインの外観とデザインに関する設定を行います
- **ライセンス設定**: アクティベーションキーを登録して特別な機能を利用できます
- **スタッフ管理**: 管理者は登録者の権限に関わらずここでスタッフの追加削除が行えます

---

## 印刷機能

- **受注書印刷**: 「伝票処理」タブでプレビュー・印刷が可能
- **宛名印刷**: 「設定」タブでテンプレートを設定し、顧客情報を自動置換

---

## データ管理機能

- **ソート機能**: 各リストはID、名前、日付、カテゴリー等でソート可能
- **検索機能**: 各タブで条件検索が可能
- **ページネーション**: 大量データも快適に閲覧
- **削除管理**: 対象外設定で論理削除による安全な管理

---

### 進捗ステータス

1. **受付中** - 新規受注、内容確認中
2. **見積中** - 見積作成・提案中
3. **作成中** - 作業実行中
4. **完成未請求** - 作業完了、請求書未発行
5. **請求済** - 請求書発行済み
6. **入金済** - 支払い完了

## よくある質問

- **Q: 未ログインの場合はどうなりますか？**
  A: ログインを促すメッセージと共に、ログイン・登録・ホームページへのリンクが表示されます。ユーザー登録が可能な環境では登録リンクも自動で表示されます。
- **Q: このプラグインは安全ですか？**
  A: はい。SQLインジェクション防止、XSS保護、CSRF対策、ファイルアップロード検証など、包括的なセキュリティ対策が実装されています。
- **Q: 既存のWordPressテーマに影響しますか？**
  A: いいえ。プラグイン専用のクラス名とCSSを使用しており、テーマとの競合を避ける設計になっています。
- **Q: データのバックアップは必要ですか？**
  A: はい。重要なビジネスデータを扱うため、定期的なWordPressデータベースのバックアップを推奨します。
- **Q: モバイルデバイスで使用できますか？**
  A: はい。レスポンシブデザインに対応しており、スマートフォンやタブレットでも使用できます。
- **Q: 協力会社の商品管理はどのように使いますか？**
  A: 協力会社詳細画面で「新しい商品・サービスを追加」フォームから商品名、単価、数量、単位を入力して管理できます。各商品は個別に削除可能で、協力会社削除時には関連商品も自動削除されます。
- **Q: インライン編集機能はどこで使えますか？**
  A: 仕事リストや受注書管理画面で案件名をクリックすると、その場で編集可能になります。変更は即座にサーバーに保存され、リアルタイムで反映されます。
- **Q: ページネーション機能はどこで動作しますか？**
  A: サービス選択ポップアップ、各データ一覧画面で利用できます。一般設定で表示件数を設定すると、その値が自動的に適用されます。
- **Q: 複数のユーザーで使用できますか？**
  A: はい。WordPressのユーザー権限機能を活用し、適切な権限を持つユーザーのみがアクセスできます。
- **Q: データのエクスポートは可能ですか？**
  A: レポート機能で集計データの出力が可能です。詳細なエクスポート機能は今後のアップデートで提供予定です。
- **Q: 受注書のレイアウトはカスタマイズできますか？**
  A: はい。設定タブでテンプレートの編集が可能です。HTML/CSSの知識があればより詳細なカスタマイズができます。
- **Q: 税込み・税抜きの計算はどうなりますか？**
  A: 仕入先には税区分の設定があり、適切な税計算が行われます。詳細は設定画面で確認してください。

## システム要件

* WordPress 5.0 以上
* PHP 7.4 以上
* MySQL 5.6 以上 または MariaDB 10.0 以上
* 推奨メモリ: 256MB 以上

---

## サポート

プラグインに関するお問い合わせやサポートは、以下までご連絡ください：

**公式サイト**: https://www.kantanpro.com/

---

## ライセンス

GPL v2 or later  
License URI: https://www.gnu.org/licenses/gpl-2.0.html

---

## 変更履歴

### 1.1.0 (beta)

* 職能管理機能を商品管理機能に拡張（商品名・単価・数量・単位の詳細管理）
* サービス選択ポップアップにページネーション機能を実装
* カード型リストビューでUI統一とレスポンシブデザイン強化
* 案件名インライン編集機能（Ajax対応、リアルタイム更新）
* データマイグレーション機能付きで既存データの安全な移行
* 一般設定との連携強化（表示件数の動的適用）
* デバッグログ機能とエラーハンドリングの改善

### 1.0.9 (beta)

* 未ログインユーザー向け表示の改善
* プラグイン名表記をKTPWPからKantanProに統一
* ユーザー登録リンクの追加（動的URL生成対応）
* ホームページリンクをルートディレクトリに修正
* UI/UX向上とユーザビリティ改善

### 1.0.8 (beta)

* プラグイン情報の表示などを修正
* 受注書タブでの請求項目とコスト項目の問題を修正
* スタッフ管理画面を追加
* ログイン中のスタッフアバターの表示するように機能追加

### 1.0.7 (beta)
* ベータ版リリース
* UI/UXを改善しました。

### 1.0.0 (beta)
* ベータ版リリース
* プラグインリファレンス機能の実装
* リファレンスモーダルとAJAXコンテンツ読み込み機能
* 包括的なセキュリティ対策の実装
* 7つの主要機能タブの完全実装
* 受注管理、顧客管理、サービス管理、仕入先管理機能
* 印刷・プレビュー機能の最適化
* レポート・分析機能の強化
* レスポンシブデザイン対応の完成